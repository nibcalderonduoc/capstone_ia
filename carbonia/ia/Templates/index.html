{% extends 'partials/base.html' %}
{% load static %}

{% block title %}Dashboard de Consumo y Emisiones{% endblock %}

{% block content %}
<h1>Dashboard de Consumo y Emisiones</h1>

<!-- Formulario de filtros -->
<form method="GET" action="{% url 'alcance1' %}" id="filterForm">
    <label for="direccion">Selecciona Direcciones:</label>
    <select name="direcciones" id="direccion" multiple>
        {% for direccion in direcciones_unicas %}
        <option value="{{ direccion }}" {% if direccion in direcciones_filtro %}selected{% endif %}>
            {{ direccion }}
        </option>
        {% endfor %}
    </select>

    <label for="year">Año:</label>
    <select name="year" id="year">
        <option value="Todos" {% if year_filtro == "Todos" %}selected{% endif %}>Todos</option>
        {% for year in years_unicos %}
        <option value="{{ year }}" {% if year_filtro == year %}selected{% endif %}>
            {{ year }}
        </option>
        {% endfor %}
    </select>

    <label for="month">Mes:</label>
    <select name="month" id="month">
        <option value="Todos" {% if month_filtro == "Todos" %}selected{% endif %}>Todos</option>
        {% for month in months_unicos %}
        <option value="{{ month }}" {% if month_filtro == month %}selected{% endif %}>
            {{ month }}
        </option>
        {% endfor %}
    </select>

    <button type="submit">Filtrar</button>
</form>

<!-- Gráfico 1: Consumo y Emisiones -->
<h2>Consumo y Emisiones Mensuales</h2>
<div>
    {{ graph1|safe }}
</div>

<!-- Gráfico 2: Comparación de Direcciones -->
<h2>Emisiones Totales por Dirección</h2>
<div>
    {{ graph2|safe }}
</div>

<!-- Tabla de datos -->
<h2>Detalles de Datos</h2>
<table>
    <thead>
        <tr>
            <th>Año</th>
            <th>Mes</th>
            <th>Dirección</th>
            <th>Consumo</th>
            <th>Emisiones (tCO2)</th>
            <th>Link PDF</th>
        </tr>
    </thead>
    <tbody>
        {% for item in data %}
        <tr>
            <td>{{ item.year }}</td>
            <td>{{ item.month }}</td>
            <td>{{ item.direccion }}</td>
            <td>{{ item.consumo }}</td>
            <td>{{ item.emisiones }}</td>
            <td><a href="{{ item.link_pdf }}" target="_blank">Ver Boleta</a></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
